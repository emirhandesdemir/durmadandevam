
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Genel kural: Varsayılan olarak tüm yollara erişimi engelle
    match /{allPaths=**} {
      allow read, write: if false;
    }

    // Kullanıcıların kendi avatarlarını yüklemesine izin ver
    match /upload/avatars/{userId}/{fileName} {
      allow read; // Allow anyone to read profile pictures
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Odalara yüklenen dosyalara izin ver (örneğin resimler)
    // Sadece giriş yapmış kullanıcılar yazabilir.
    match /upload/rooms/{roomId}/{allPaths=**} {
        allow read;
        allow write: if request.auth != null;
    }

    // DM'lere yüklenen dosyalara izin ver
    // Sadece ilgili sohbetin katılımcıları okuyabilir ve yazabilir.
    match /dms/{chatId}/{allPaths=**} {
        allow read, write: if request.auth != null && resource.metadata.chatId == chatId;
    }
  }
}
