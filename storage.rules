// Firebase Storage Güvenlik Kuralları
// Bu kurallar, dosya depolama alanına kimin, hangi dosyaları,
// ne koşullarda yükleyebileceğini ve okuyabileceğini belirler.
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
  
    // Genel Kural: Varsayılan olarak tüm okuma ve yazma işlemlerini reddet.
    match /{allPaths=**} {
      allow read, write: if false;
    }

    // Avatar Yüklemeleri:
    // Kullanıcılar sadece kendi avatar dosyalarını güncelleyebilir.
    // Sadece belirli boyutta (5MB) ve türde (resim) dosyalara izin verilir.
    match /upload/avatars/{userId}/{fileName} {
      allow read: if true; // Herkes profil resimlerini görebilir.
      allow write: if request.auth != null 
                    && request.auth.uid == userId
                    && request.resource.size < 5 * 1024 * 1024
                    && request.resource.contentType.matches('image/.*');
    }

    // Gönderi Resimleri:
    // Kimliği doğrulanmış kullanıcılar resim yükleyebilir.
    // Dosya boyutu 10MB ile sınırlıdır.
    match /upload/posts/{userId}/{fileName} {
      allow read: if true; // Herkes gönderi resimlerini görebilir.
      allow write: if request.auth != null 
                    && request.auth.uid == userId
                    && request.resource.size < 10 * 1024 * 1024
                    && request.resource.contentType.matches('image/.*');
    }
    
    // Oda Resimleri (Sohbet içinde gönderilenler):
    // Kimliği doğrulanmış kullanıcılar resim veya video yükleyebilir.
    // Dosya boyutu 25MB ile sınırlıdır.
    match /upload/rooms/{roomId}/{mediaType}/{fileName} {
       allow read: if true;
       allow write: if request.auth != null
                     && request.resource.size < 25 * 1024 * 1024
                     && (request.resource.contentType.matches('image/.*') || request.resource.contentType.matches('video/.*'));
    }
    
    // Direkt Mesaj Dosyaları:
    // Kimliği doğrulanmış kullanıcılar resim, video veya ses dosyası yükleyebilir.
    // Dosya boyutu 25MB ile sınırlıdır.
    match /dms/{chatId}/{mediaType}/{fileName} {
       allow read, write: if request.auth != null
                          && request.resource.size < 25 * 1024 * 1024
                          && (request.resource.contentType.matches('image/.*') || request.resource.contentType.matches('video/.*') || request.resource.contentType.matches('audio/.*'));
    }
  }
}
