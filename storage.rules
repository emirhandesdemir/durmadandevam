rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Genel kural: Varsayılan olarak kimse hiçbir şeye yazamaz.
    match /{allPaths=**} {
      allow read: if true; // Herkes her şeyi okuyabilir (genel gönderiler, vb.)
      allow write: if false; // Varsayılan olarak yazma kapalı.
    }

    // Kullanıcıların profil fotoğrafları için özel kurallar.
    match /upload/avatars/{userId}/{allPaths=**} {
      // Herkes avatarları okuyabilir.
      allow read: if true;
      // Sadece giriş yapmış ve kendi klasörüne yazan kullanıcılar yazabilir.
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Gönderi resimleri için özel kurallar.
    match /upload/posts/{userId}/{allPaths=**} {
        allow read: if true;
        allow write: if request.auth != null && request.auth.uid == userId;
    }
    
     // Surf videoları için özel kurallar.
    match /upload/videos/{userId}/{allPaths=**} {
        allow read: if true;
        allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // DM resimleri için özel kurallar.
    match /dms/{chatId}/{allPaths=**} {
        allow read, write: if request.auth != null;
        // Daha detaylı kurallar eklenebilir. Örn: if request.auth.uid in get(/databases/$(database)/documents/directMessagesMetadata/$(chatId)).data.participantUids
    }
  }
}
